@model CareConnect.Models.TrackingGenerateViewModel


<!-- Your HTML structure -->
<div id="pdfContainer">
    <!-- This div will hold the PDF content -->
</div>
<div class="card">

    <div class="card-header" style="background-color: #0565B7;color:white">
        <h3 class="card-title">Claim Detail</h3>

    </div>
    <div class="card-body">
        @if (Model.SearchClaimDetail != null && Model.SearchClaimDetail.Tables.Count > 0 && Model.SearchClaimDetail.Tables[0].Rows.Count > 0)
        {
            <table id="bookingstatusTable" width="100%" class="display">
                <thead>
                    <tr>
                        @foreach (System.Data.DataColumn column in Model.SearchClaimDetail.Tables[0].Columns)
                        {
                            <th>@column.ColumnName</th>

                        }
                        <th>Claim Form</th>

                    </tr>
                </thead>
                <tbody>
                    @foreach (System.Data.DataRow row in Model.SearchClaimDetail.Tables[0].Rows)
                    {
                        var originResponse = row["Origin_Response"].ToString().Trim();
                        var destinationResponse = row["Destination_Response"].ToString().Trim();
                        var rmsResponse = row["RMS_Response"].ToString().Trim();
                        var dgmResponse = row["DGM_Response"].ToString().Trim();
                        var bgColor = "";

                        // Set background color based on conditions
                        if (originResponse == "Yes")
                        {
                            bgColor = "Coral";
                        }

                        if (originResponse == "Yes" && destinationResponse == "Yes")
                        {
                            bgColor = "#6495ED";
                        }

                        if (originResponse == "Yes" && destinationResponse == "Yes" && rmsResponse == "Yes")
                        {
                            bgColor = "#f39c12";
                        }

                        if (originResponse == "Yes" && destinationResponse == "Yes" && rmsResponse == "Yes" && dgmResponse == "Yes")
                        {
                            bgColor = "LightGreen";
                        }

                        <tr style="background-color: @bgColor;">
                            @foreach (var item in row.ItemArray)
                            {
                                <td>
                                    @if (row.Table.Columns.IndexOf("ClaimID") == Array.IndexOf(row.ItemArray, item))
                                    {
                                        <a class="ticketLink" href="/Home/GetClaimDetailsbyClaimid?ticketno=@item.ToString()" target="_blank">@item.ToString()</a>

                                    }
                                    else
                                    {
                                        @item.ToString()
                                    }
                                </td>
                            }
                            <td>
                            @*    <a class="ticketLink" href="/Home/GetClaimDetailsbyClaimid?ticketno=" target="_blank">claimform</a> *@


                                <a href="@Url.Action("Report", "Home")" class="report-link" data-id="@row["ClaimID"]">Claim Form Download</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>No Records Found.</p>
        }
    </div>
</div>
<br />


<!-- Your JavaScript code -->
<script>
    $('.report-link').click(function (e) {
        debugger
        e.preventDefault(); // Prevent the default behavior of the link

        // Get the ID from the data-id attribute
        var reportId = $(this).data('id');

        // Make an AJAX request to the Print action with the ID parameter
        $.ajax({
            url: '/Home/Report',
            type: 'GET',
            data: { id: reportId },
            success: function (result) {
                // Create a unique identifier for the iframe
                var iframeId = 'pdfViewer_' + Date.now();

                // Append an iframe to the pdfContainer div
                $('#pdfContainer').empty(); // Clear previous content if any
                $('#pdfContainer').append('<iframe id="' + iframeId + '" width="100%" height="900px"></iframe>');

                // Set the PDF content as the source of the iframe
                $('#' + iframeId).attr('src', 'data:application/pdf;base64,' + result);
            },
            error: function (error) {
                console.error(error);
            }
        });
    });
</script>

<script>
    $(document).ready(function () {

        $('#bookingstatusTable').DataTable({
            scrollX: '400px',
            scrollY: '400px', // Specify the desired height of the scrollable area
            scrollCollapse: true,
            language: {
                paginate: {
                    first: 'First',
                    previous: 'Previous',
                    next: 'Next',
                    last: 'Last'
                }
            }

        });
    });
    //$(document).on('click', '.detailButton', function () {
    //    debugger
    //    var ticketId = $(this).data('ticketid');
    //    var url = '/Home/GetTicketDetails?ticketno=' + ticketId;

    //    window.open(url, '_blank');

    //});
</script>







